server:
  port: 8761

eureka:
  instance:
    # This is dynamically set from the Ansible inventory for each host.
    hostname: {{ eureka_hostname }}

  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      # The list of peers is generated by the playbook.
      # It includes all nodes in the 'eureka_nodes' group except for the current node itself.
      defaultZone: {% set peers = [] %}{% for host in groups['eureka_nodes'] %}{% if host != inventory_hostname %}{% set _ = peers.append('http://' + hostvars[host]['eureka_hostname'] + ':8761/eureka/') %}{% endif %}{% endfor %}{{ peers | join(',') }}

  server:
    # Forcing eviction of dead instances faster than the default.
    enable-self-preservation: false
    eviction-interval-timer-in-ms: 5000

# Basic security for the Eureka dashboard (optional, can be expanded)
spring:
  security:
    user:
      name: fazeal-admin
      # The password should be stored in Ansible Vault in a real deployment
      password: "password-is-insecure-use-vault"

# Expose health endpoints for monitoring
management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: ALWAYS
