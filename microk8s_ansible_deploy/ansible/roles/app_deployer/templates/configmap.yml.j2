---
apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ app.name }}-config"
  namespace: "{{ app.namespace | default('default') }}"
  labels:
    app: "{{ app.name }}"
data:
  # Common environment variables
  {% for key, value in common_env.items() %}
  {{ key }}: {{ value | to_json }}
  {% endfor %}

  # Service-specific environment variables
  {% if app.env is defined %}
  {% for item in app.env %}
  {{ item.name }}: {{ item.value | to_json }}
  {% endfor %}
  {% endif %}

  # Special case for eureka instance ip-address
  eureka.instance.ip-address: "{{ app.name }}-service"
