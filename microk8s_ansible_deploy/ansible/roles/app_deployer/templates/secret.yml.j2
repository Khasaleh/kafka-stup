---
apiVersion: v1
kind: Secret
metadata:
  name: "{{ app.name }}-secret"
  namespace: "{{ app.namespace | default('default') }}"
  labels:
    app: "{{ app.name }}"
type: Opaque
data:
  # Encode all secret values as Base64
  DB_USER: "{{ db_user | b64encode }}"
  DB_PASSWORD: "{{ db_password | b64encode }}"
  amazonProperties.accessKey: "{{ aws_access_key | b64encode }}"
  amazonProperties.secretKey: "{{ aws_secret_key | b64encode }}"
  AWS_ACCESS_KEY: "{{ aws_access_key | b64encode }}"
  AWS_SECRET_KEY: "{{ aws_secret_key | b64encode }}"
  amazonProperties.assetsSecretKey: "{{ aws_secret_key | b64encode }}"
  amazonProperties.assetsAccessKey: "{{ aws_access_key | b64encode }}"
  JWT_SECRET: "{{ jwt_secret | b64encode }}"
  REDIS_PASSWORD: "{{ redis_password | b64encode }}"

  # Add any service-specific secrets, also base64 encoded
  {% if app.secrets is defined %}
  {% for item in app.secrets %}
  "{{ item.name }}": "{{ item.value | b64encode }}"
  {% endfor %}
  {% endif %}
